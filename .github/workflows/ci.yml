name: Quick CI

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master ]

jobs:
  quick-check:
    runs-on: ubuntu-22.04
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential cppcheck
        sudo apt-get install -y qt6-base-dev libgl1-mesa-dev
        sudo apt-get install -y libxcb-cursor0 libxcb-icccm4 libxcb-keysyms1
        sudo apt-get install -y libxcb-shape0 libxcb-xfixes0 libxcb-randr0
        sudo apt-get install -y libxkbcommon-x11-0

    - name: Static Analysis
      run: |
        echo "ğŸ” Running static analysis..."
        cppcheck --enable=warning,performance \
                 --suppress=missingIncludeSystem \
                 --suppress=unknownMacro \
                 --language=c++ \
                 --std=c++17 \
                 --quiet \
                 -I src -I include \
                 src/*.cpp 2>&1 || true
        echo "âœ… Static analysis completed"

    - name: Compile Check
      run: |
        echo "ğŸ”¨ Checking if code compiles..."
        mkdir -p build && cd build
        qmake6 ../UnifiedFloppyTool.pro CONFIG+=release 2>&1 || true
        make -j$(nproc) 2>&1 | tail -50
        echo "âœ… Compile check completed"

  ci-summary:
    needs: [quick-check]
    runs-on: ubuntu-latest
    if: always()
    steps:
    - name: CI Summary
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  CI Summary: ${{ needs.quick-check.result }}"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
